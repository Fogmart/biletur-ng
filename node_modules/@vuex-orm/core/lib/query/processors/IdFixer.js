import * as tslib_1 from "tslib";
import Utils from '../../support/Utils';
var IdFixer = /** @class */ (function () {
    function IdFixer() {
    }
    /**
     * Fix all of the "no key" records with appropriate id value if it can.
     */
    IdFixer.process = function (query, data) {
        var _this = this;
        return Utils.mapValues(data, function (records, entity) {
            var newQuery = query.newQuery(entity);
            return _this.processRecords(records, newQuery);
        });
    };
    /**
     * Process records to Fix all of the "no key" records with
     * appropriate id value if it can.
     */
    IdFixer.processRecords = function (records, query) {
        return Object.keys(records).reduce(function (newRecords, id) {
            var record = records[id];
            var newId = query.model.id(record);
            var newStringId = isNaN(newId) ? newId : newId.toString();
            if (newId === undefined || id === newStringId) {
                newRecords[id] = record;
                return newRecords;
            }
            newRecords[newStringId] = tslib_1.__assign({}, record, { $id: newId });
            return newRecords;
        }, {});
    };
    return IdFixer;
}());
export default IdFixer;
//# sourceMappingURL=IdFixer.js.map